# TODO List

## Критичные задачи (выполнено)
- ✅ Исправлена ошибка компиляции: дублирование categoryCount и totalPrice в email-templates-tournament.ts
- ✅ Добавлен горизонтальный скролл для таблиц в админке (/admin/logs и другие страницы)
- ✅ Добавлены переводы для действий в логах (login, logout, send_email, register) в en.json
- ✅ Добавлен User ID под email в колонке User в логах
- ✅ Для Entity Type - Pair - Update добавлена информация о затронутых пользователях (affectedUserIds, affectedUserEmails)
- ✅ Улучшена фильтрация логов: теперь фильтр по user ID или email показывает действия как сделанные пользователем, так и сделанные по отношению к нему
- ✅ Исправлена страница логов: добавлен горизонтальный скролл (min-w-[1600px]), кнопки копирования для User и Entity ID
- ✅ Добавлены переводы для Admin.logs.entityTypes.tournament_registration для всех языков
- ✅ Исправлена логика снятия выделения после удаления участника/пользователя
- ✅ Заменен window.confirm на ConfirmDialog в AdminUsersContent
- ✅ Исправлена логика клика на иконку "Турниры" в свернутом меню админки
- ✅ Добавлены переводы для Admin.users.confirmDeleteUser для всех языков
- ✅ Созданы страницы для всех подразделов настроек админки (courts, extras, pricing, holidays, policies, company, clubs, admins, terms)
- ✅ Создана страница not-found.tsx для админских настроек с ссылками на Settings и Dashboard
- ✅ Исправлена проблема с белым экраном при переходе на страницы настроек - теперь отображается корректная 404 страница

## Осталось выполнить

### 1. Переводы для остальных языков
- [x] Добавить переводы ResetPassword и ошибок логина для de, it, ca, nl, da, sv, no, ar, zh - ✅ Выполнено
- [x] Добавить переводы Admin.logs.actions.login, logout, send_email, register для всех языков (кроме en) - ✅ Выполнено
- [x] Добавить переводы Admin.logs.affectedUsers и Admin.logs.affectedEmails для всех языков - ✅ Выполнено
- [x] Добавить перевод Admin.settings.comingSoon для всех языков - ✅ Уже добавлен во всех языках

### 2. Функционал страниц настроек админки
- [x] Реализовать функционал страницы Courts (/admin/settings/courts) - ✅ Выполнено
  - Создана таблица courts в БД
  - Созданы API endpoints для CRUD операций
  - Реализован компонент CourtsSettingsContent с выбором клуба и управлением кортами
- [x] Реализовать функционал страницы Extras (/admin/settings/extras) - ✅ Выполнено
- [x] Реализовать функционал страницы Pricing (/admin/settings/pricing) - ✅ Выполнено
- [x] Реализовать функционал страницы Holidays (/admin/settings/holidays) - ✅ Выполнено
- [x] Реализовать функционал страницы Policies (/admin/settings/policies) - ✅ Выполнено
- [x] Реализовать функционал страницы Company (/admin/settings/company) - ✅ Выполнено
  - Создана таблица company_info в БД
  - Создан API endpoint для управления информацией о компании
  - Реализован компонент CompanySettingsContent
- [x] Реализовать функционал страницы Clubs (/admin/settings/clubs) - ✅ Выполнено
  - Реализован компонент ClubsSettingsContent с управлением клубами для суперадмина
- [x] Реализовать функционал страницы Manage Admins (/admin/settings/admins) - ✅ Выполнено
  - Реализован компонент AdminsSettingsContent для управления администраторами клубов
- [x] Реализовать функционал страницы Terms (/admin/settings/terms) - ✅ Выполнено
  - Создана таблица terms в БД
  - Созданы API endpoints для CRUD операций
  - Реализован компонент TermsSettingsContent

### 3. Дополнительные улучшения (опционально)
- [x] Проверить работу горизонтального скролла на всех страницах админки - ✅ Проверено: AdminLogsContent (min-w-[1600px]), AdminUsersContent (min-w-[1200px]), TournamentParticipantsPage (min-w-[1400px])
- [x] Добавить подсказки/тултипы для Entity ID колонки - ✅ Добавлен тултип с объяснением Entity ID для всех 14 языков
- [ ] Оптимизировать производительность фильтрации логов при большом количестве записей
- [x] Улучшить отображение 404 страницы для админки - добавлена страница not-found.tsx с ссылками на Settings и Dashboard

### 8. Система отправки email и шаблоны (выполнено в этом чате)
- [x] Исправлена ошибка non-ASCII символов в email from поле - ✅ Заменен символ ₂ на 2, добавлена функция извлечения email из формата "Display Name <email>"
- [x] Исправлены французские переводы для Admin.staff.editPlayers и manageRegistrations - ✅ Переводы добавлены в правильный блок Admin.staff
- [x] Исправлена проблема с сохранением роли Manager - ✅ Добавлена валидация роли, детальное логирование, использование CAST для явного преобразования типа
- [x] Добавлен favicon.ico как логотип для всех пользователей админ-панели - ✅ Упрощена логика отображения логотипа, убраны проверки роли и companyLogo
- [ ] **ОСТАЛОСЬ**: Исправить проблему с сохранением роли Manager - роль не сохраняется в БД, возвращается participant вместо manager

### 4. Исправления UI/UX админ-панели
- [x] Добавить отступ сверху на странице /admin/tournaments (чтобы кнопка "Crear Torneo" не перекрывалась языковым селектором) - ✅ Выполнено
- [x] Добавить отступ сверху на странице /admin/users (чтобы кнопки не перекрывались языковым селектором) - ✅ Выполнено
- [x] Проверить все страницы админки на перекрытие элементов языковым селектором - ✅ Проверено и исправлено
- [x] Исправить tooltip для Entity ID - он выходит за границы таблицы (проблема с z-index/слоями) - ✅ Исправлено: изменено позиционирование на right-0, увеличен z-index до z-[100]
- [x] Исправить отступы на странице /admin/settings при свернутом левом меню (текст идет вплотную к меню) - ✅ Выполнено
- [x] Исправить отступы на странице /admin/messages при свернутом левом меню - ✅ Выполнено

### 5. Улучшение системы логирования
- [x] При регистрации на турнир логировать детали:
  - На какой турнир зарегистрировался - ✅ Выполнено
  - В какие категории - ✅ Выполнено
  - Информация о партнере (если есть) - ✅ Выполнено
  - Информация о партнерах по категориям - ✅ Выполнено
  - Информация о детях - ✅ Выполнено
  - Сообщение пользователя - ✅ Выполнено
  - Детали турнира (даты, локация, цены) - ✅ Выполнено
- [x] Логировать отправку email для верификации после регистрации - ✅ Выполнено
- [x] Логировать отправку tournament registration email - ✅ Выполнено
- [x] Логировать подтверждение email (когда пользователь переходит по ссылке) - ✅ Выполнено
- [x] Логировать отправку welcome email - ✅ Выполнено
- [x] Логировать подтверждение регистраций на турниры - ✅ Выполнено
- [x] Улучшить отображение деталей в логах для регистраций на турнир - ✅ Выполнено (читабельный формат вместо JSON)

### 6. Система клубов и доступов
- [x] Создать таблицу `clubs` в базе данных со структурой:
  - id, name, address, description, location, working_hours, created_at, updated_at - ✅ Выполнено
- [x] Создать таблицу `user_club_access` для управления доступом к клубам - ✅ Выполнено
- [x] Создать таблицу `user_tournament_access` для управления доступом к турнирам - ✅ Выполнено
- [x] Добавить поле `club_id` в таблицу `tournaments` - ✅ Выполнено
- [x] Создать первый клуб "Padel La Masia, Carrer de Mallorca, Blanes" - ✅ Выполнено (автоматически при инициализации БД)
- [x] Создать API endpoints для работы с клубами - ✅ Выполнено
- [x] На странице /admin/staff добавить выбор клуба при назначении доступа (Assign Access)
  - Пользователь может быть админом/ролью для конкретного клуба - ✅ Выполнено
  - Пользователь может быть админом/ролью для конкретного турнира - ✅ Выполнено
  - Поддержка множественного выбора (несколько клубов/турниров) - ✅ Выполнено
- [x] При создании турнира добавить выбор клуба из списка существующих - ✅ Выполнено
- [x] При создании турнира добавить возможность создать новый клуб - ✅ Выполнено
- [x] Реализовать логику доступа:
  - Суперадмин имеет доступ ко всем клубам - ✅ Выполнено
  - Админ клуба имеет доступ только к настройкам своего клуба - ✅ Выполнено (через checkClubAccessFromSession)

### 7. Реализация страниц настроек клуба
- [x] Страница Courts (/admin/settings/courts): - ✅ Выполнено
  - Указать количество кортов - ✅ Выполнено
  - Локация каждого корта - ✅ Выполнено
  - Название корта - ✅ Выполнено
  - Описание корта - ✅ Выполнено
  - Тип корта (открытый/закрытый, покрытие и т.д.) - ✅ Выполнено
  - Часы работы каждого корта - ✅ Выполнено
  - Возможность добавить/удалить корт - ✅ Выполнено
- [x] Страница Holidays (/admin/settings/holidays): - ✅ Выполнено
  - Указать выходные дни клуба - ✅ Выполнено
  - Календарь для выбора дат - ✅ Выполнено
  - Возможность установить повторяющиеся праздники (ежегодно) - ✅ Выполнено
- [x] Страница Extras (/admin/settings/extras): - ✅ Выполнено
  - Дополнительные услуги клуба - ✅ Выполнено
  - Цены на услуги - ✅ Выполнено
  - Описание услуг - ✅ Выполнено
- [x] Страница Pricing (/admin/settings/pricing): - ✅ Выполнено
  - Структура цен для бронирования кортов - ✅ Выполнено
  - Цены для турниров - ✅ Выполнено
  - Цены для членства - ✅ Выполнено
  - Разные тарифы для разных временных слотов - ✅ Выполнено
- [x] Страница Policies (/admin/settings/policies): - ✅ Выполнено
  - Правила клуба - ✅ Выполнено
  - Политика отмены - ✅ Выполнено
  - Политика возврата средств - ✅ Выполнено
  - Другие правила - ✅ Выполнено
- [x] Страница Company (/admin/settings/company): - ✅ Выполнено
  - Информация о компании - ✅ Выполнено
  - Контакты - ✅ Выполнено
  - Логотип - ✅ Выполнено
  - Описание - ✅ Выполнено
- [x] Страница Clubs (/admin/settings/clubs): - ✅ Выполнено
  - Список всех клубов (для суперадмина) - ✅ Выполнено
  - Создание нового клуба - ✅ Выполнено
  - Редактирование клуба - ✅ Выполнено
  - Удаление клуба - ✅ Выполнено
- [x] Страница Manage Admins (/admin/settings/admins): - ✅ Выполнено
  - Управление администраторами клуба - ✅ Выполнено
  - Назначение прав доступа - ✅ Выполнено
  - Удаление администраторов - ✅ Выполнено
- [x] Страница Terms (/admin/settings/terms): - ✅ Выполнено
  - Условия использования - ✅ Выполнено
  - Политика конфиденциальности - ✅ Выполнено
  - Другие документы - ✅ Выполнено

