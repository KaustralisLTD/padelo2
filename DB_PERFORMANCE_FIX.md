# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î

## –ü—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

### 1. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å `SELECT * FROM users WHERE email = 'admin@padelo2.com'`
- **–í—ã–ø–æ–ª–Ω–µ–Ω**: 45 —Ä–∞–∑
- **–í—Ä–µ–º—è**: 8 –º–∏–Ω—É—Ç 7 —Å–µ–∫—É–Ω–¥ (00:08:07)
- **–ü—Ä–æ–±–ª–µ–º–∞**: 
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SELECT *`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è `photo_data` (LONGTEXT)
  - –í–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω–¥–µ–∫—Å –Ω–∞ `email`
  - –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ

### 2. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ ID
- **–í—ã–ø–æ–ª–Ω–µ–Ω**: 3 —Ä–∞–∑–∞
- **–í—Ä–µ–º—è**: 26 —Å–µ–∫—É–Ω–¥ (00:00:26)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–ø—Ä–æ—Å –ø–æ PRIMARY KEY –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–∫–∏–º –º–µ–¥–ª–µ–Ω–Ω—ã–º

### 3. CREATE TABLE –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **–í—Ä–µ–º—è**: 9 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, —Ö–æ—Ç—è –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

## –†–µ—à–µ–Ω–∏—è

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ

1. **–ó–∞–º–µ–Ω–µ–Ω `SELECT *` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è** –≤ `lib/users.ts`:
   - –ò—Å–∫–ª—é—á–µ–Ω `photo_data` (LONGTEXT) –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è

2. **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤**: `scripts/check-and-fix-indexes.ts`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
   - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
   - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–°–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç**: `scripts/add-performance-indexes.sql`
   - –î–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ phpMyAdmin
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

#### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ phpMyAdmin –∏–ª–∏ MySQL –∫–ª–∏–µ–Ω—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ users
SHOW INDEX FROM users;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ sessions
SHOW INDEX FROM sessions;
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `users`:**
- `PRIMARY` –Ω–∞ `id`
- `idx_email` –Ω–∞ `email` (–∏–ª–∏ `email` –∫–∞–∫ UNIQUE)
- `idx_role` –Ω–∞ `role`

#### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã

–ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
npm run check-indexes
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ email (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
CREATE INDEX idx_email ON users(email);

-- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ role (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
CREATE INDEX idx_role ON users(role);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
SHOW INDEX FROM users;
```

#### –®–∞–≥ 3: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É

```sql
-- –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
ANALYZE TABLE users;
ANALYZE TABLE sessions;
```

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
EXPLAIN SELECT id, email, first_name, last_name, role FROM users WHERE email = 'admin@padelo2.com';
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ `EXPLAIN` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- `key`: `idx_email` –∏–ª–∏ `email`
- `rows`: 1 (–∏–ª–∏ –æ—á–µ–Ω—å –º–∞–ª–æ)
- `type`: `ref` –∏–ª–∏ `const`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

–î–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞) –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

```typescript
// –ü—Ä–∏–º–µ—Ä –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è production –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis)
const adminCache = new Map<string, { user: User; expires: number }>();
const CACHE_TTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

–ò–∑–±–µ–≥–∞–π—Ç–µ:
- ‚ùå `SELECT *` - –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è
- ‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ `photo_data` –≤ –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- ‚ùå N+1 –∑–∞–ø—Ä–æ—Å—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ JOIN –∏–ª–∏ `Promise.all()`)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è –≤ SELECT
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö
- ‚úÖ JOIN –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ `LIMIT` –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```typescript
const startTime = Date.now();
const result = await pool.execute(query, params);
const queryTime = Date.now() - startTime;

if (queryTime > 1000) {
  console.warn(`Slow query detected: ${queryTime}ms`, { query, params });
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ email –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 100ms** (–≤–º–µ—Å—Ç–æ 8+ –º–∏–Ω—É—Ç)
2. **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ ID –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 50ms** (–≤–º–µ—Å—Ç–æ 26 —Å–µ–∫—É–Ω–¥)
3. **–ò–Ω–¥–µ–∫—Å—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è** (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ EXPLAIN)

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- ‚úÖ `lib/users.ts` - –∑–∞–º–µ–Ω–µ–Ω `SELECT *` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è
- ‚úÖ `scripts/check-and-fix-indexes.ts` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ `scripts/add-performance-indexes.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ `package.json` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `npm run check-indexes`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run check-indexes` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

